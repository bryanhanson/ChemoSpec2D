<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>PARAFAC Analysis of a Spectra2D Object — pfacSpectra2D • ChemoSpec2D</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="PARAFAC Analysis of a Spectra2D Object — pfacSpectra2D" />
<meta property="og:description" content="Carry out PARAFAC analysis of a Spectra2D object.
Function parafac from multiway is used.
For large data sets, computational time may be long enough that
it might desirable to run in batch mode and possibly use parallel processing." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ChemoSpec2D</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.187</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ChemoSpec2D.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bryanhanson/ChemoSpec2D/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>PARAFAC Analysis of a Spectra2D Object</h1>
    <small class="dont-index">Source: <a href='https://github.com/bryanhanson/ChemoSpec2D/blob/master/R/pfacSpectra2D.R'><code>R/pfacSpectra2D.R</code></a></small>
    <div class="hidden name"><code>pfacSpectra2D.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Carry out PARAFAC analysis of a <code><a href='Spectra2D.html'>Spectra2D</a></code> object.
Function <code><a href='https://rdrr.io/pkg/multiway/man/parafac.html'>parafac</a></code> from <span class="pkg">multiway</span> is used.
For large data sets, computational time may be long enough that
it might desirable to run in batch mode and possibly use parallel processing.</p>
    </div>

    <pre class="usage"><span class='fu'>pfacSpectra2D</span><span class='op'>(</span><span class='va'>spectra</span>, parallel <span class='op'>=</span> <span class='cn'>FALSE</span>, setup <span class='op'>=</span> <span class='cn'>FALSE</span>, nfac <span class='op'>=</span> <span class='fl'>2</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>spectra</th>
      <td><p>An object of S3 class <code><a href='Spectra2D.html'>Spectra2D</a></code>.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>Logical.  Should parallel processing be used?
Unless you love waiting, you should use parallel processing for larger data sets.
If you are working on a shared machine and/or another process (created by you or
another user) might also try to access all or some of the cores in your CPU,
you should be careful to avoid hogging the cores.
<code><a href='https://rdrr.io/r/parallel/detectCores.html'>parallel::detectCores()</a></code> will tell you how many cores are available to everyone.
You can run <code><a href='https://rdrr.io/r/base/options.html'>options(mc.cores = 2)</a></code> to set the number of cores this function will use.</p></td>
    </tr>
    <tr>
      <th>setup</th>
      <td><p>Logical.  If <code>TRUE</code> the parallel environment will be automatically
configured for you.  If <code>FALSE</code>, the user must configure the environment
themselves (desirable for instance if working on Azure or AWS EC2).</p></td>
    </tr>
    <tr>
      <th>nfac</th>
      <td><p>Integer.  The number of factors/components to compute.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional parameters to be passed to function <code><a href='https://rdrr.io/pkg/multiway/man/parafac.html'>parafac</a></code>.
You should give thought to value of <code>const</code>, allowed options can be seen in
<code><a href='https://rdrr.io/pkg/CMLS/man/const.html'>const</a></code>. The default is to compute an unconstrained solution.
However, in some cases one may wish to apply a non-negativity constraint.  Also,
to suppress the progress bar, you can use <code>verbose = FALSE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>pfac</code> and <code>parafac</code>, modified to include a list
element called <code>$method</code> which is <code>parafac</code>.</p>
    <h2 class="hasAnchor" id="warning"><a class="anchor" href="#warning"></a>Warning</h2>

    

<p>To get reproducible results you will need to <code><a href='https://rdrr.io/r/base/Random.html'>set.seed()</a></code>.  See the example.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>R. Bro "PARAFAC. Tutorial and applications" <em>Chemometrics and Intelligent
Laboratory Systems</em> vol. 38 pgs. 149-171 (1997).</p>
<p>A. Smilde, R. Bro and P. Geladi
"Multi-way Analysis: Applications in the Chemical Sciences" Wiley (2004).</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>For other data reduction methods for <code>Spectra2D</code> objects, see
<code><a href='miaSpectra2D.html'>miaSpectra2D</a></code> and <code><a href='popSpectra2D.html'>popSpectra2D</a></code>.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Bryan A. Hanson, DePauw University.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>MUD1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span>
<span class='va'>res</span> <span class='op'>&lt;-</span> <span class='fu'>pfacSpectra2D</span><span class='op'>(</span><span class='va'>MUD1</span>, parallel <span class='op'>=</span> <span class='cn'>FALSE</span>, nfac <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======                                                               |  10%  |                                                                              |==============                                                        |  20%  |                                                                              |=====================                                                 |  30%  |                                                                              |============================                                          |  40%  |                                                                              |===================================                                   |  50%  |                                                                              |==========================================                            |  60%  |                                                                              |=================================================                     |  70%  |                                                                              |========================================================              |  80%  |                                                                              |===============================================================       |  90%  |                                                                              |======================================================================| 100%</div><div class='input'><span class='fu'><a href='plotScores.html'>plotScores</a></span><span class='op'>(</span><span class='va'>MUD1</span>, <span class='va'>res</span>,
  leg.loc <span class='op'>=</span> <span class='st'>"topright"</span>,
  ellipse <span class='op'>=</span> <span class='st'>"cls"</span>, main <span class='op'>=</span> <span class='st'>"PARAFAC Score Plot"</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in (function (spectra, so, pcs = c(1, 2), ellipse = "none", tol = "none",     use.sym = FALSE, leg.loc = "topright", ...) {    args &lt;- as.list(match.call())[-1]    if (length(pcs) != 2)         stop("You must choose exactly two PC's to plot")    case &lt;- NULL    if (inherits(spectra, "Spectra"))         case &lt;- "PCA"    if (inherits(spectra, "Spectra2D"))         case &lt;- "MIA"    if (inherits(so, "pop"))         case &lt;- "PCA"    if (is.null(case))         stop("Could not reconcile data object and scores object.")    if ((case == "MIA") &amp;&amp; (use.sym))         stop("ChemoSpec2D does not support use.sym")    chkSpectra(spectra)    if (case == "PCA")         DF &lt;- data.frame(so$x[, pcs], group = spectra$groups)    if (case == "MIA")         DF &lt;- data.frame(so$C[, pcs], group = spectra$groups)    GRPS &lt;- dlply(DF, "group", subset, select = c(1, 2))    if ((ellipse == "cls") || (ellipse == "rob") || (ellipse ==         "both")) {        gr &lt;- sumGroups(spectra)        for (n in 1:length(gr$group)) {            if (gr$no.[n] == 1)                 message("Group ", gr$group[n], "\n\thas only 1 member (no ellipse possible)")            if (gr$no.[n] == 2)                 message("Group ", gr$group[n], "\n\thas only 2 members (no ellipse possible)")            if (gr$no.[n] == 3)                 message("Group ", gr$group[n], "\n\thas only 3 members (ellipse not drawn)")        }        idx &lt;- which(gr$no. &gt; 3)        gr &lt;- gr[idx, ]        ELL &lt;- llply(GRPS[idx], .computeEllipses)        x.scores &lt;- range(llply(GRPS, subset, select = 1))        y.scores &lt;- range(llply(GRPS, subset, select = 2))        x.ell &lt;- range(llply(ELL, function(x) {            range(x[1])        }))        y.ell &lt;- range(llply(ELL, function(x) {            range(x[2])        }))        x.ell.r &lt;- range(llply(ELL, function(x) {            range(x[4])        }))        y.ell.r &lt;- range(llply(ELL, function(x) {            range(x[5])        }))        x.all &lt;- range(x.scores, x.ell, x.ell.r)        x.all &lt;- x.all + diff(x.all) * 0.05 * c(-1, 1.15)        y.all &lt;- range(y.scores, y.ell, y.ell.r)        y.all &lt;- y.all + diff(x.all) * 0.05 * c(-1, 1.15)    }    if (ellipse == "none") {        x.scores &lt;- range(llply(GRPS, subset, select = 1))        y.scores &lt;- range(llply(GRPS, subset, select = 2))        x.all &lt;- range(x.scores) + diff(range(x.scores)) * 0.05 *             c(-1, 1.15)        y.all &lt;- range(y.scores) + diff(range(y.scores)) * 0.05 *             c(-1, 1.15)    }    dPargs &lt;- list(PCs = DF[, 1:2], spectra = spectra, case = case,         use.sym = use.sym, ... = ...)    if (!"xlim" %in% names(args))         dPargs &lt;- c(dPargs, list(xlim = x.all))    if (!"ylim" %in% names(args))         dPargs &lt;- c(dPargs, list(ylim = y.all))    do.call(.drawPoints, dPargs)    if ((ellipse == "cls") | (ellipse == "rob") | (ellipse ==         "both"))         .drawEllipses(ELL, gr, ellipse, use.sym, ...)    if (case == "PCA") {        .addMethod(so)        if (leg.loc != "none")             .addLegend(spectra, leg.loc, use.sym, bty = "n")        .addEllipseInfo(ellipse)    }    if (case == "MIA") {        if (leg.loc != "none")             .addLegend(spectra, leg.loc, use.sym = FALSE, bty = "n")        .addEllipseInfo(ellipse)    }    if (tol != "none")         .labelExtremes(DF[, 1:2], spectra$names, tol)})(spectra = MUD1, so = res, ellipse = "cls", leg.loc = "topright",     main = "PARAFAC Score Plot", xlab = "Component 1", ylab = "Component 2",     use.sym = FALSE): object 'res' not found</span></div><div class='input'><span class='va'>res1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='plotLoadings2D.html'>plotLoadings2D</a></span><span class='op'>(</span><span class='va'>MUD1</span>, <span class='va'>res</span>,
  load_lvls <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>5</span>, <span class='fl'>10</span>, <span class='fl'>15</span>, <span class='fl'>25</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='st'>"PARAFAC Comp. 1 Loadings"</span>
<span class='op'>)</span>
</div><div class='img'><img src='pfacSpectra2D-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='va'>res2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='plotLoadings2D.html'>plotLoadings2D</a></span><span class='op'>(</span><span class='va'>MUD1</span>, <span class='va'>res</span>,
  load_lvls <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>5</span>, <span class='fl'>10</span>, <span class='fl'>15</span>, <span class='fl'>25</span><span class='op'>)</span>,
  ref <span class='op'>=</span> <span class='fl'>2</span>, ref_lvls <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>5</span>, <span class='fl'>35</span>, <span class='fl'>5</span><span class='op'>)</span>,
  ref_cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"black"</span>, <span class='fl'>7</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='st'>"PARAFAC Comp. 1 Loadings + Ref. Spectrum"</span>
<span class='op'>)</span>
</div><div class='img'><img src='pfacSpectra2D-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Selection of loading matrix levels can be aided by the following</span>
<span class='co'># Use res1$names to find the index of the loadings</span>

<span class='fu'><a href='inspectLvls.html'>inspectLvls</a></span><span class='op'>(</span><span class='va'>res1</span>,
  which <span class='op'>=</span> <span class='fl'>11</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>50</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='st'>"Histogram of Loadings Matrix"</span>
<span class='op'>)</span>
</div><div class='img'><img src='pfacSpectra2D-3.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Bryan A. Hanson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


