<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Plain Old PCA (POP) of Spectra2D Objects — popSpectra2D • ChemoSpec2D</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Plain Old PCA (POP) of Spectra2D Objects — popSpectra2D" />
<meta property="og:description" content="This function unstacks a Spectra2D object and conducts IRLBA
PCA on it.
To unstack, each F1 slice (parallel to F2) is concatenated one after the other
so that each 2D spectrum becomes a 1D spectrum.  The length of this spectrum will be
equal to the length of the F2 dimension times the length of the F1 dimension.
PCA is performed on the collection of 1D spectra (one spectrum from each 2D spectrum).
The IRLBA algorithm is used because the resulting matrix (n samples  in rows x F1 * F2 columns)
can be very large, and other PCA algorithms can struggle." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ChemoSpec2D</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ChemoSpec2D.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bryanhanson/ChemoSpec2D/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Plain Old PCA (POP) of Spectra2D Objects</h1>
    <small class="dont-index">Source: <a href='https://github.com/bryanhanson/ChemoSpec2D/blob/master/R/popSpectra2D.R'><code>R/popSpectra2D.R</code></a></small>
    <div class="hidden name"><code>popSpectra2D.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function unstacks a <code>Spectra2D</code> object and conducts IRLBA
PCA on it.
To unstack, each F1 slice (parallel to F2) is concatenated one after the other
so that each 2D spectrum becomes a 1D spectrum.  The length of this spectrum will be
equal to the length of the F2 dimension times the length of the F1 dimension.
PCA is performed on the collection of 1D spectra (one spectrum from each 2D spectrum).
The IRLBA algorithm is used because the resulting matrix (n samples  in rows x F1 * F2 columns)
can be very large, and other PCA algorithms can struggle.</p>
    </div>

    <pre class="usage"><span class='fu'>popSpectra2D</span><span class='op'>(</span><span class='va'>spectra</span>, n <span class='op'>=</span> <span class='fl'>3</span>, choice <span class='op'>=</span> <span class='st'>"noscale"</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>spectra</th>
      <td><p>An object of S3 class <code><a href='Spectra2D.html'>Spectra2D</a></code>.</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>Integer. The number of components desired.</p></td>
    </tr>
    <tr>
      <th>choice</th>
      <td><p>A character string indicating the choice of scaling.  One of
<code>c("noscale"</code>, <code>"autoscale"</code>, <code>"Pareto")</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other parameters to be passed to <code><a href='https://rdrr.io/pkg/irlba/man/prcomp_irlba.html'>prcomp_irlba</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of classes <code>prcomp</code>, <code>pop</code> and <code>computed_via_irlba</code>
modified to include a list element called <code>$method</code>, a character string describing the
pre-processing carried out and the type of PCA performed (used to annotate
plots).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The scale choice <code>autoscale</code> scales the columns by their standard
deviation.  <code>Pareto</code> scales by the square root of the standard
deviation. <code>"autoscale"</code> is called "standard normal variate" or "correlation matrix PCA"
in some literature.  This action is performed on the unstacked matrix, as is centering.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>J. Baglama and L. Reichel, "Augmented Implicitly Restarted Lanczos
Bidiagonalization Methods"  <em>SIAM J. Sci. Comput.</em> (2005).</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>For other data reduction methods for <code>Spectra2D</code> objects, see
<code><a href='miaSpectra2D.html'>miaSpectra2D</a></code> and <code><a href='pfacSpectra2D.html'>pfacSpectra2D</a></code>.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Bryan A. Hanson, DePauw University.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://ggplot2.tidyverse.org'>"ggplot2"</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>MUD1</span><span class='op'>)</span>
<span class='va'>res</span> <span class='op'>&lt;-</span> <span class='fu'>popSpectra2D</span><span class='op'>(</span><span class='va'>MUD1</span><span class='op'>)</span>

<span class='co'># plotScores &amp; plotScree use ggplot2 graphics</span>

<span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='plotScores.html'>plotScores</a></span><span class='op'>(</span><span class='va'>MUD1</span>, <span class='va'>res</span>, ellipse <span class='op'>=</span> <span class='st'>"cls"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in (function (spectra, so, pcs = c(1, 2), ellipse = "none", tol = "none",     use.sym = FALSE, leg.loc = "topright", ...) {    args &lt;- as.list(match.call())[-1]    if (length(pcs) != 2)         stop("You must choose exactly two PC's to plot")    case &lt;- NULL    if (inherits(spectra, "Spectra"))         case &lt;- "PCA"    if (inherits(spectra, "Spectra2D"))         case &lt;- "MIA"    if (inherits(so, "pop"))         case &lt;- "PCA"    if (is.null(case))         stop("Could not reconcile data object and scores object.")    if ((case == "MIA") &amp;&amp; (use.sym))         stop("ChemoSpec2D does not support use.sym")    chkSpectra(spectra)    if (case == "PCA")         DF &lt;- data.frame(so$x[, pcs], group = spectra$groups)    if (case == "MIA")         DF &lt;- data.frame(so$C[, pcs], group = spectra$groups)    GRPS &lt;- dlply(DF, "group", subset, select = c(1, 2))    if ((ellipse == "cls") || (ellipse == "rob") || (ellipse ==         "both")) {        gr &lt;- sumGroups(spectra)        for (n in 1:length(gr$group)) {            if (gr$no.[n] == 1)                 message("Group ", gr$group[n], "\n\thas only 1 member (no ellipse possible)")            if (gr$no.[n] == 2)                 message("Group ", gr$group[n], "\n\thas only 2 members (no ellipse possible)")            if (gr$no.[n] == 3)                 message("Group ", gr$group[n], "\n\thas only 3 members (ellipse not drawn)")        }        idx &lt;- which(gr$no. &gt; 3)        gr &lt;- gr[idx, ]        ELL &lt;- llply(GRPS[idx], .computeEllipses)    }    go &lt;- chkGraphicsOpt()    if (go == "base") {        if ((ellipse == "cls") || (ellipse == "rob") || (ellipse ==             "both")) {            x.scores &lt;- range(llply(GRPS, subset, select = 1))            y.scores &lt;- range(llply(GRPS, subset, select = 2))            x.ell &lt;- range(llply(ELL, function(x) {                range(x[1])            }))            y.ell &lt;- range(llply(ELL, function(x) {                range(x[2])            }))            x.ell.r &lt;- range(llply(ELL, function(x) {                range(x[4])            }))            y.ell.r &lt;- range(llply(ELL, function(x) {                range(x[5])            }))            x.all &lt;- range(x.scores, x.ell, x.ell.r)            x.all &lt;- x.all + diff(x.all) * 0.05 * c(-1, 1.15)            y.all &lt;- range(y.scores, y.ell, y.ell.r)            y.all &lt;- y.all + diff(x.all) * 0.05 * c(-1, 1.15)        }        if (ellipse == "none") {            x.scores &lt;- range(llply(GRPS, subset, select = 1))            y.scores &lt;- range(llply(GRPS, subset, select = 2))            x.all &lt;- range(x.scores) + diff(range(x.scores)) *                 0.05 * c(-1, 1.15)            y.all &lt;- range(y.scores) + diff(range(y.scores)) *                 0.05 * c(-1, 1.15)        }        dPargs &lt;- list(PCs = DF[, 1:2], spectra = spectra, case = case,             use.sym = use.sym, ... = ...)        if (!"xlim" %in% names(args))             dPargs &lt;- c(dPargs, list(xlim = x.all))        if (!"ylim" %in% names(args))             dPargs &lt;- c(dPargs, list(ylim = y.all))        do.call(.drawPoints, dPargs)        if ((ellipse == "cls") | (ellipse == "rob") | (ellipse ==             "both"))             .drawEllipses(ELL, gr, ellipse, use.sym, ...)        if (case == "PCA") {            .addMethod(so)            if (all(leg.loc != "none")) {                leg.loc &lt;- .prepLegendCoords(go, leg.loc, x.all[1],                   x.all[2], y.all[1], y.all[2])                .addLegend(spectra, leg.loc, use.sym, bty = "n")            }            .addEllipseInfo(ellipse)        }        if (case == "MIA") {            if (all(leg.loc != "none")) {                leg.loc &lt;- .prepLegendCoords(go, leg.loc, x.all[1],                   x.all[2], y.all[1], y.all[2])                .addLegend(spectra, leg.loc, use.sym = FALSE,                   bty = "n")            }            .addEllipseInfo(ellipse)        }        if (tol != "none")             .labelExtremes(DF[, 1:2], spectra$names, tol)    }    if ((go == "ggplot2") || (go == "plotly")) {        args &lt;- as.list(match.call()[-1])        xlab &lt;- eval(args$xlab)        ylab &lt;- eval(args$ylab)        .chkReqGraphicsPkgs("ggplot2")        x &lt;- y &lt;- name &lt;- label &lt;- NULL        if (case == "PCA") {            if (!use.sym) {                p &lt;- ggplot(DF) + geom_point(aes_string(x = colnames(DF)[1],                   y = colnames(DF)[2]), color = spectra$colors,                   shape = 20, size = 3) + labs(x = xlab, y = ylab)            }            if (use.sym) {                p &lt;- ggplot(DF) + geom_point(aes_string(x = colnames(DF)[1],                   y = colnames(DF)[2]), color = "black", shape = spectra$sym) +                   labs(x = xlab, y = ylab)            }            if (go == "ggplot2") {                p &lt;- p + .ggAnnotate(so$method, x = 0.05, y = 0.98,                   just = "left", gp = gpar(fontsize = 8))            }        }        if (case == "MIA") {            p &lt;- ggplot(DF) + geom_point(aes_string(x = colnames(DF)[1],                 y = colnames(DF)[2]), color = spectra$colors,                 shape = 20, size = 3)        }        p &lt;- p + theme_bw() + theme(panel.grid.major = element_blank(),             panel.grid.minor = element_blank())        if ((ellipse == "cls") | (ellipse == "rob") | (ellipse ==             "both")) {            .ggPrepEllipseCoords &lt;- function(data) {                df &lt;- data.frame(x = numeric(), y = numeric(),                   name = character())                for (i in 1:length(data)) {                  x &lt;- c()                  y &lt;- c()                  name &lt;- c()                  total &lt;- length(data[[i]])/2                  for (j in 1:total) {                    x &lt;- c(x, data[[i]][j, 1])                    y &lt;- c(y, data[[i]][j, 2])                  }                  name &lt;- rep(names(data)[i], total)                  temp &lt;- data.frame(x, y, name)                  df &lt;- rbind(df, temp)                }                return(df)            }        }        if (ellipse == "cls") {            cls.coords &lt;- llply(ELL, function(x) {                x[1:2]            })            cls.coords &lt;- llply(cls.coords, function(x) {                do.call(cbind, x)            })            df.cls &lt;- .ggPrepEllipseCoords(cls.coords)            if (!use.sym) {                p &lt;- p + geom_path(data = df.cls, aes(x = x,                   y = y, color = name), linetype = 2) + scale_color_manual(values = gr$color)            }            if (use.sym) {                color.black &lt;- rep("black", length(gr$color))                p &lt;- p + geom_path(data = df.cls, aes(x = x,                   y = y, color = name), linetype = 2) + scale_color_manual(values = color.black)            }            if (go == "ggplot2") {                p &lt;- p + .ggAnnotate("cls")            }        }        if (ellipse == "rob") {            rob.coords &lt;- llply(ELL, function(x) {                x[4:5]            })            rob.coords &lt;- llply(rob.coords, function(x) {                do.call(cbind, x)            })            df.rob &lt;- .ggPrepEllipseCoords(rob.coords)            if (!use.sym) {                p &lt;- p + geom_path(data = df.rob, aes(x = x,                   y = y, color = name)) + scale_color_manual(values = gr$color)            }            if (use.sym) {                color.black &lt;- rep("black", length(gr$color))                p &lt;- p + geom_path(data = df.rob, aes(x = x,                   y = y, color = name)) + scale_color_manual(values = color.black)            }            if (go == "ggplot2") {                p &lt;- p + .ggAnnotate("rob")            }        }        if (ellipse == "both") {            cls.coords &lt;- llply(ELL, function(x) {                x[1:2]            })            cls.coords &lt;- llply(cls.coords, function(x) {                do.call(cbind, x)            })            df.cls &lt;- .ggPrepEllipseCoords(cls.coords)            rob.coords &lt;- llply(ELL, function(x) {                x[4:5]            })            rob.coords &lt;- llply(rob.coords, function(x) {                do.call(cbind, x)            })            df.rob &lt;- .ggPrepEllipseCoords(rob.coords)            if (!use.sym) {                lines &lt;- rep(2, length(gr$color))                p &lt;- p + geom_path(data = df.cls, aes(x = x,                   y = y, color = name), linetype = 2)                p &lt;- p + geom_path(data = df.rob, aes(x = x,                   y = y, color = name)) + scale_color_manual(values = gr$color)            }            if (use.sym) {                color.black &lt;- rep("black", length(gr$color))                p &lt;- p + geom_path(data = df.cls, aes(x = x,                   y = y, color = name))                p &lt;- p + geom_path(data = df.rob, aes(x = x,                   y = y, color = name), linetype = 2) + scale_color_manual(values = color.black)            }            if (go == "ggplot2") {                p &lt;- p + .ggAnnotate("both")            }        }        if (go == "ggplot2") {            if (tol != "none") {                CoordList &lt;- .getExtremeCoords(DF[, 1:2], spectra$names,                   tol)                df &lt;- data.frame(x = CoordList$x, y = CoordList$y,                   label = CoordList$l)                p &lt;- p + .ggRepel(df)            }            p &lt;- p + theme(legend.position = "none")            if (all(leg.loc != "none")) {                p &lt;- p + .ggAddLegend(spectra, use.sym, leg.loc)            }            return(p)        }        else {            .chkReqGraphicsPkgs("plotly")            p &lt;- ggplotly(p, tooltip = c(colnames(DF[1]), colnames(DF[2]),                 "name"))            if (tol != "none") {                CoordList &lt;- .getExtremeCoords(DF[, 1:2], spectra$names,                   tol)                df &lt;- data.frame(x = CoordList$x, y = CoordList$y,                   label = CoordList$l)                p &lt;- p %&gt;% add_annotations(x = df$x, y = df$y,                   text = df$label, xref = "x", yref = "y", showarrow = TRUE,                   arrowhead = 4, arrowsize = 0.5, ax = 40, ay = -25,                   font = list(size = 12))            }            p &lt;- p %&gt;% layout(showlegend = FALSE)            return(p)        }    }})(spectra = MUD1, so = res, ellipse = "cls", xlab = "Component 1 (47.64%)",     ylab = "Component 2 (29.76%)", use.sym = FALSE): object 'res' not found</span></div><div class='input'><span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='va'>p1</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"POP Scores"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'p1' not found</span></div><div class='input'><span class='va'>p1</span>
</div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'p1' not found</span></div><div class='input'>
<span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='plotScree.html'>plotScree</a></span><span class='op'>(</span><span class='va'>res</span><span class='op'>)</span>
<span class='va'>p2</span>
</div><div class='img'><img src='popSpectra2D-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># plotLoadings2D uses base graphics</span>

<span class='va'>MUD1a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='plotLoadings2D.html'>plotLoadings2D</a></span><span class='op'>(</span><span class='va'>MUD1</span>, <span class='va'>res</span>,
  load_lvls <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.2</span>, <span class='op'>-</span><span class='fl'>0.1</span>, <span class='fl'>0.1</span>, <span class='fl'>0.2</span><span class='op'>)</span>,
  load_cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"black"</span>, <span class='fl'>4</span><span class='op'>)</span>, main <span class='op'>=</span> <span class='st'>"POP Comp. 1 Loadings"</span><span class='op'>)</span>
</div><div class='img'><img src='popSpectra2D-2.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Bryan A. Hanson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


